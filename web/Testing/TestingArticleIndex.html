<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>jQuery UI Droppable - Simple photo manager</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <style>
        #gallery {
            float: left;
            width: 65%;
            min-height: 12em;
        }

        .gallery.custom-state-active {
            background: #eee;
        }

        .gallery li {
            float: left;
            width: 96px;
            padding: 0.4em;
            margin: 0 0.4em 0.4em 0;
            text-align: center;
        }

        .gallery li h5 {
            margin: 0 0 0.4em;
            cursor: move;
        }

        .gallery li a {
            float: right;
        }

        .gallery li a.ui-icon-zoomin {
            float: left;
        }

        .gallery li img {
            width: 100%;
            cursor: move;
        }

        #save {
            float: right;
            width: 32%;
            min-height: 18em;
            padding: 1%;
        }

        #save h4 {
            line-height: 16px;
            margin: 0 0 0.4em;
        }

        #save h4 .ui-icon {
            float: left;
        }

        #save .gallery h5 {
            display: none;
        }
    </style>


</head>
<body>

<div class="ui-widget ui-helper-clearfix">

    <ul id="gallery" class="gallery ui-helper-reset ui-helper-clearfix ui-droppable">
        <li class="ui-widget-content ui-corner-tr ui-draggable ui-draggable-handle">
            <h5 class="ui-widget-header">High Tatras</h5>\ <p class="made">blah</p>
            <!--<img src="images/high_tatras_min.jpg" alt="The peaks of High Tatras" width="150" height="150">-->
            <a href="images/high_tatras.jpg" title="View larger image" class="ui-icon ui-icon-zoomin">View larger</a>
            <a href="link/to/trash/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-trash">Delete
                image</a>
        </li>


        <li class="ui-widget-content ui-corner-tr ui-draggable ui-draggable-handle">
            <h5 class="ui-widget-header">aaaaaa</h5>
            <p class="made">blah</p>
            <p>hello</p>
            <img src="images/high_tatras4_min.jpg" alt="On top of Kozi kopka" width="96" height="72">
            <p>there</p>
            <a href="images/high_tatras4.jpg" title="View larger image" class="ui-icon ui-icon-zoomin">View larger</a>
            <a href="link/to/trash/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-trash">Delete
                image</a>
        </li>
        <li class="ui-widget-content ui-corner-tr ui-draggable ui-draggable-handle">
            <h5 class="ui-widget-header">cccccbbbbbbb</h5>
            <p class="made">blah</p>
            <!--<img src="images/high_tatras_min.jpg" alt="The peaks of High Tatras" width="150" height="150">-->
            <a href="images/high_tatras.jpg" title="View larger image" class="ui-icon ui-icon-zoomin">View larger</a>
            <a href="link/to/trash/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-trash">Delete
                image</a>
        </li>
        <li class="ui-widget-content ui-corner-tr ui-draggable ui-draggable-handle">
            <h5 class="ui-widget-header">aaaacasdasccsdasdccc</h5>
            <p class="made">blah</p>
            <!--<img src="images/high_tatras2_min.jpg" alt="The chalet at the Green mountain lake" width="96" height="72">-->
            <a href="images/high_tatras2.jpg" title="View larger image" class="ui-icon ui-icon-zoomin">View larger</a>
            <a href="link/to/trash/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-trash">Delete
                image</a>
        </li>
        <li class="ui-widget-content ui-corner-tr ui-draggable ui-draggable-handle">
            <h5 class="ui-widget-header">ffffff</h5>
            <p class="made">ggggg</p>
            <!--<img src="images/high_tatras3_min.jpg" alt="Planning the ascent" width="96" height="72">-->
            <a href="images/high_tatras3.jpg" title="View larger image" class="ui-icon ui-icon-zoomin">View larger</a>
            <a href="link/to/trash/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-trash">Delete
                image</a>
        </li>
        <li class="ui-widget-content ui-corner-tr ui-draggable ui-draggable-handle">
            <h5 class="ui-widget-header">ccceeeeeee</h5>
            <p class="made">asdasdasd</p>
            <!--<img src="images/high_tatras4_min.jpg" alt="On top of Kozi kopka" width="96" height="72">-->
            <a href="images/high_tatras4.jpg" title="View larger image" class="ui-icon ui-icon-zoomin">View larger</a>
            <a href="link/to/trash/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-trash">Delete
                image</a>
        </li>
    </ul>

    <div id="save" class="ui-widget-content ui-state-default ui-droppable">
        <ul class="gallery ui-helper-reset">
        </ul>
    </div>
    <textarea id="textarea"></textarea>


</div>

<script>

    //    $(".ui-widget-content.ui-corner-tr.ui-draggable.ui-draggable-handle:not(#save *)").each(function () {
    //        things.push($(this));
    //        console.log(things);
    //    });
    var things = [];
    function defaultSort(elementX, elementY) {
        if (elementX.children().siblings("h5").text() < elementY.children().siblings("h5").text())
            return -1;
        if (elementX.children().siblings("h5").text() > elementY.children().siblings("h5").text())
            return 1;
        return 0;
    }


    //    mixture.sort(defaultSort);
    //    $("#textarea").bind('keyup', function () {
    ////        for (var i = 0; i < things.length; i++) {
    ////            console.log("out");
    ////            things[i].fadeOut("fast");
    ////            things[i].promise().done(function () {
    ////                console.log("out z");
    ////                $(things[i]).css("z-index", -1);
    ////            })
    ////        }
    //       console.log(things);
    //        var thins2 = things.sort(defaultSort).slice(0);
    //        console.log("done out")
    //        var thins2 = things.sort(defaultSort);
    //        console.log(thins2);
    ////        for (var i = 0; i < thins2.length; i++) {
    ////            console.log("in");
    ////            thins2[i].fadeIn("slow");
    ////            thins2[i].promise().done(function () {
    ////                console.log("in z");
    ////                $(thins2[i]).css("z-index", 0);
    ////            })
    ////        }
    //        console.log("done in")
    //    });
    function faddingout(int) {
        for (var i = 0; i < int.length; i++) {
            console.log("out");
            int[i].fadeOut("fast");
            int[i].promise().done(function () {
                console.log("out z");
                $(int[i]).css("z-index", -1);
            })
        }
        return;
    }

    function faddingin(int) {
        for (var i = 0; i < int.length; i++) {
            console.log("out");
            int[i].fadeIn("fast");
            int[i].promise().done(function () {
                console.log("in z");
                $(int[i]).css("z-index", 0);
            })
        }

        return;
    }
    $(function () {

        // There's the gallery and the trash
        var $gallery = $("#gallery"),
            $save = $("#save");

        // Let the gallery items be draggable
        $("li", $gallery).draggable({
            cancel: "a.ui-icon", // clicking an icon won't initiate dragging
            revert: "invalid", // when not dropped, the item will revert back to its initial position
            containment: "document",
            helper: "clone",
            cursor: "move"
        });

        // Let the trash be droppable, accepting the gallery items
        $save.droppable({
            accept: "#gallery > li",
            classes: {
                "ui-droppable-active": "ui-state-highlight"
            },
            drop: function (event, ui) {
                deleteImage(ui.draggable);
            }
        });

        // Let the gallery be droppable as well, accepting items from the trash
        $gallery.droppable({
            accept: "#save li",
            classes: {
                "ui-droppable-active": "custom-state-active"
            },
            drop: function (event, ui) {
                recycleImage(ui.draggable);
            }
        });

        // Image deletion function
        var recycle_icon = "<a href='link/to/recycle/script/when/we/have/js/off' title='Recycle this image' class='ui-icon ui-icon-refresh'>Recycle image</a>";

        function deleteImage($item) {
            console.log("put into save")
            $item.fadeOut(function () {
                var $list = $("ul", $save).length ?
                    $("ul", $save) :
                    $("<ul class='gallery ui-helper-reset'/>").appendTo($save);

                $item.find("a.ui-icon-trash").remove();
                $item.append(recycle_icon).appendTo($list).fadeIn(function () {
                    $item
                        .animate({width: "48px"})
                        .find("img")
                        .animate({height: "36px"});
                });
            });
        }

        // Image recycle function
        var trash_icon = "<a href='link/to/trash/script/when/we/have/js/off' title='Delete this image' class='ui-icon ui-icon-trash'>Delete image</a>";

        function recycleImage($item) {
            console.log("recycle to gallery")
            $item.fadeOut(function () {
                $item
                    .find("a.ui-icon-refresh")
                    .remove()
                    .end()
                    .css("width", "96px")
                    .append(trash_icon)
                    .find("img")
                    .css("height", "72px")
                    .end()
                    .appendTo($gallery)
                    .fadeIn();
            });
        }

        // Image preview function, demonstrating the ui.dialog used as a modal window
        function viewLargerImage($link) {
            console.log("veiw large");
            var src = $link.attr("href"),
                title = $link.siblings("img").attr("alt"),
                $modal = $("img[src$='" + src + "']");
            console.log($link.siblings(""))
            if ($modal.length) {
                $modal.dialog("open");
            } else {
                var img = $("<img alt='" + title + "' width='384' height='288' style='display: none; padding: 8px;' />")
                    .attr("src", src).appendTo("body");
                setTimeout(function () {
                    img.dialog({
                        title: title,
                        width: 400,
                        modal: true
                    });
                }, 1);
            }
        }

        // Resolve the icons behavior with event delegation
        $("ul.gallery > li").on("click", function (event) {
            var $item = $(this),
                $target = $(event.target);
            console.log($target);
            console.log("Check current location");
            if ($target.is("a.ui-icon-trash")) {
                console.log("1");
                deleteImage($item);
            } else if ($target.is("a.ui-icon-zoomin")) {
                console.log("2");
                viewLargerImage($target);
            } else if ($target.is("a.ui-icon-refresh")) {
                console.log("3");
                recycleImage($item);
            }

            return false;
        });
        $("#textarea").bind('keyup', function (e) {
            if (e.keyCode == 13) {
            $("ul.gallery > li").each(function () {
                things.push($(this));
                $(this).fadeOut("fast", function () {
                    $(this).css("z-index", -1);
                })
                things.sort(defaultSort);
                console.log(things);
                deleteImage($(this));
            });
            }
            if (e.keyCode == 8){
                things.sort(defaultSort);
                console.log(things)
                for (var i = 0; i < things.length; i++) {
                    $(things[i]).fadeIn("fast",function () {
                        $(this).css("z-index",0);
                    });
                    recycleImage($(things[i]));
                }
            }
        });
//        $("#textarea").bind('keyup', function () {
//            console.log(things);
//            things.sort(defaultSort);
//            for (var i = 0; i < things.length; i++) {
//                recycleImage($(things[i]));
//            }
//        });

    })


</script>

</body>
</html>